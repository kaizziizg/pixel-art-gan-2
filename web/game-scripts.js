var Player=pc.createScript("player");Player.attributes.add("skin",{type:"number",default:1}),Player.attributes.add("speed",{type:"number",default:2}),Player.attributes.add("cameraEntity",{type:"entity",default:!1}),Player.attributes.add("rightWall",{type:"number",default:2.2}),Player.attributes.add("leftWall",{type:"number",default:-2.2}),Player.attributes.add("topWall",{type:"number",default:1.39}),Player.attributes.add("bottomWall",{type:"number",default:-1.01}),Player.attributes.add("isGround",{type:"boolean",default:!1}),Player.attributes.add("isJump",{type:"boolean",default:!1}),Player.prototype.initialize=function(){this.touchpos=new pc.Vec3,this.touchInit(),this.addBtnListenWithOuterHtml(),this.coords=new pc.Vec3,this.camera=this.app.root.findByName("Camera").camera;var t=this.app.touch;t&&(t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this)),this.on("destroy",(function(){t.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this)}),this)},Player.prototype.touchInit=function(){this.isTouch=!1,this.isTouchJump=!1,this.isLeftTouch=!1,this.isRightTouch=!1,this.isUpTouch=!1,this.isZTouch=!1,this.isXTouch=!1,this.isCTouch=!1,this.isVTouch=!1,this.isATouch=!1,this.isSTouch=!1},Player.prototype.update=function(t){this.move(t),this.checkjumpGround(t),this.checkBound(t),this.isTouch&&this.touchMove(t)},Player.prototype.touchMove=function(t){this.touchpos.x<0&&this.entity.translate(-this.speed*t,0,0),this.touchpos.x>0&&this.entity.translate(this.speed*t,0,0),this.isTouchJump&&this.isGround&&(this.isJump=!0,this.isGround=!1)},Player.prototype.onTouchStart=function(t){this.isTouch=!0,1===t.touches.length&&(this.cameraEntity.camera.screenToWorld(t.touches[0].x,t.touches[0].y,4,this.touchpos),console.log(this.touchpos.x+"  "+this.touchpos.y)),2===t.touches.length&&(this.isTouchJump=!0),t.event.preventDefault()},Player.prototype.onTouchEnd=function(t){this.isTouch=!1,this.isTouchJump=!1,t.event.preventDefault()},Player.prototype.move=function(t){var i=this.app.keyboard.isPressed(pc.KEY_LEFT),s=this.app.keyboard.isPressed(pc.KEY_RIGHT),e=this.app.keyboard.isPressed(pc.KEY_UP),h=this.app.keyboard.isPressed(pc.KEY_DOWN);(i||this.isLeftTouch)&&this.entity.translate(-this.speed*t,0,0),(s||this.isRightTouch)&&this.entity.translate(this.speed*t,0,0),(e&&this.isGround||this.isUpTouch&&this.isGround)&&(this.isJump=!0,this.isGround=!1),h&&this.entity.translate(0,-this.speed*t,0)},Player.prototype.checkjumpGround=function(t){let i=this.entity.getPosition();this.isJump&&(this.entity.translate(0,this.speed*t*(this.bottomWall-i.y+2.2),0),i.y>-.4&&(this.isJump=!1)),this.isGround||this.isJump||(this.entity.translate(0,-this.speed*t,0),i.y<this.bottomWall+.01&&(this.entity.setPosition(i.x,i.y-this.topWall+2.2,i.z),this.isGround=!0,this.entity.setPosition(i.x,this.bottomWall,i.z)))},Player.prototype.checkBound=function(t){let i=this.entity.getPosition();i.x<this.leftWall&&this.entity.setPosition(this.leftWall+.001,i.y,i.z),i.x>this.rightWall&&this.entity.setPosition(this.rightWall-.001,i.y,i.z),i.y>this.topWall&&this.entity.setPosition(i.x,this.topWall-.001,i.z),i.y<this.bottomWall&&this.entity.setPosition(i.x,this.bottomWall,i.z)};class longBtn{constructor(t,i,s){this.event_listener(t),this.arg=i,this.p=s}mDown=()=>{let t=`p.${this.arg} = true`;Function("p",t)(this.p)};mUp=()=>{let t=`p.${this.arg} = false`;Function("p",t)(this.p)};event_listener=t=>{let i=document.getElementById(t);i&&(i.addEventListener("mousedown",this.mDown),i.addEventListener("mouseup",this.mUp),i.addEventListener("touchstart",this.mDown),i.addEventListener("touchend",this.mUp))}}Player.prototype.addBtnListenWithOuterHtml=function(){this.htmlRightBtn=new longBtn("Right","isRightTouch",this),this.htmlLeftBtn=new longBtn("Left","isLeftTouch",this),this.htmlLeftBtn=new longBtn("Up","isUpTouch",this)};var Network=pc.createScript("network");Network.attributes.add("skin",{type:"number",default:1}),Network.attributes.add("player",{type:"entity"}),Network.attributes.add("emoji",{type:"entity"}),Network.attributes.add("other",{type:"entity"}),Network.attributes.add("name",{type:"string",default:"noName"}),Network.attributes.add("prePos",{type:"vec3"}),Network.id=null,Network.socket=null,Network.name=null;class Character{constructor(t,e,i,s,o){this.id=t,this.name=e,this.x=i,this.y=s,this.z=0,this.entity=o,this.skin=1,this.skinTimeout=null}}Network.prototype.initialize=function(){this.timeout=null;const t=new URLSearchParams(window.location.search);t.has("name")&&(this.name=t.get("name")),this.player.children[0].children[0].element.text=this.name,this.addBtnListenWithOuterHtml(),t.has("skin")&&(this.skin=parseInt(t.get("skin"),10)),console.log(this.skin),this.player.sprite.play("Clip "+(this.skin%29+1));const e=new WebSocket("wss://pixel-art-gan-2-tvuvdrqvfq-de.a.run.app/");Network.socket=e,this.players=new Map,this.prePos=this.player.getPosition(),this.emojiEnable=()=>{this.emoji.enabled=!0},this.emojiDisable=()=>{clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.emoji.enabled=!1}),1e3)};var i=this;let s={type:"initialize",name:this.name,skin:this.skin};e.addEventListener("open",(function(){e.send(JSON.stringify(s))})),e.addEventListener("message",(({data:t})=>{const e=JSON.parse(t);switch(e.type){case"playerMoved":i.movePlayer(e);break;case"playerJoined":console.log(`${e.player.name} is online!`),i.addPlayer(e);break;case"playerData":i.initializePlayers(e);break;case"killPlayer":i.removePlayer(e);break;case"emoji":i.emojiPlayer(e);break;default:throw new Error(`Unsupported event type: ${e.type}.`)}}))},Network.prototype.update=function(t){(this.app.keyboard.wasPressed(pc.KEY_Z)||this.isZTouch)&&this.showEmoji("sleep"),(this.app.keyboard.wasPressed(pc.KEY_X)||this.isXTouch)&&this.showEmoji("suprise"),(this.app.keyboard.wasPressed(pc.KEY_C)||this.isCTouch)&&this.showEmoji("heart"),(this.app.keyboard.wasPressed(pc.KEY_V)||this.isVTouch)&&this.showEmoji("facepalm"),(this.app.keyboard.wasPressed(pc.KEY_A)||this.isATouch)&&this.showEmoji("angry"),(this.app.keyboard.wasPressed(pc.KEY_S)||this.isSTouch)&&this.showEmoji("777"),this.prePos.x===this.player.getPosition().x&&this.prePos.y===this.player.getPosition().y||(this.prePos=this.player.getPosition(),this.updatePosition())},Network.prototype.showEmoji=function(t){let e={type:"emoji",emoji:t};Network.socket.send(JSON.stringify(e)),this.emojiEnable(),this.emoji.sprite.play(t),this.emojiDisable()},Network.prototype.updatePosition=function(){if(Network.socket.readyState==WebSocket.OPEN){let t=this.player.getPosition(),e={type:"playerMoved",name:this.name,x:t.x,y:t.y};Network.socket.send(JSON.stringify(e))}},Network.prototype.initializePlayers=function(t){Network.id=t.id;for(let e in t.players)p=new Character(t.players[e].id,t.players[e].name,t.players[e].x,t.players[e].y,this.createPlayerEntity(t.players[e])),this.players.set(t.players[e].id,p)},Network.prototype.addPlayer=function(t){p=new Character(t.player.id,t.player.name,t.player.x,t.player.y,this.createPlayerEntity(t.player)),this.players.set(t.player.id,p)},Network.prototype.createPlayerEntity=function(t){if(t.id!=Network.id){this.other.children[0].children[0].element.text=t.name;let e=this.other.clone();return this.app.root.addChild(e),e.enabled=!0,e.setPosition(t.x,t.y,0),e.sprite.play("Clip "+(t.skin%29+1)),e}},Network.prototype.movePlayer=function(t){t.id!=Network.id&&Network.socket.readyState==WebSocket.OPEN&&this.players.get(t.id).entity.setPosition(t.x,t.y,0)},Network.prototype.emojiPlayer=function(t){if(t.id!=Network.id&&Network.socket.readyState==WebSocket.OPEN){let e=this.players.get(t.id).entity.findByName("emoji");e.enabled=!0,e.sprite.play(t.emoji),clearTimeout(this.players.get(t.id).skinTimeout),this.players.get(t.id).skinTimeout=setTimeout((()=>{e.enabled=!1}),1e3)}},Network.prototype.removePlayer=function(t){this.players.get(t.id).entity&&(this.players.get(t.id).entity.destroy(),this.players.delete(t.id))},Network.prototype.touchInit=function(){this.isZTouch=!1,this.isXTouch=!1,this.isCTouch=!1,this.isVTouch=!1,this.isATouch=!1,this.isSTouch=!1},Network.prototype.addBtnListenWithOuterHtml=function(){this.htmlRightBtn=new longBtn("Z","isZTouch",this),this.htmlRightBtn=new longBtn("X","isXTouch",this),this.htmlRightBtn=new longBtn("C","isCTouch",this),this.htmlRightBtn=new longBtn("V","isVTouch",this),this.htmlRightBtn=new longBtn("A","isATouch",this),this.htmlRightBtn=new longBtn("S","isSTouch",this)};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://res.cloudinary.com/startup-grind/image/upload/dpr_2.0,fl_sanitize/v1/gcs/platform-data-dsc/contentbuilder/logo_dark_horizontal_097s7oa.svg",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));
